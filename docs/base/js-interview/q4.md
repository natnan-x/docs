<!--
 * @Author: NanNan
 * @Date: 2025-10-31 22:52:43
 * @LastEditTime: 2025-10-31 23:21:11
 * @Description:
-->

# 对于 Proxy 的理解

::: warning 写在前面
<b>面试回答可以按 概念 → 特性 → 用途 → 举例 的顺序组织，简明扼要</b>
:::

## 1. 概念

- Proxy 是 ES6 新特性，用于创建一个对象的“代理”，<b>可以拦截和自定义对对象的基本操作</b>。
- 基本操作包括：<b>属性访问、赋值、删除、函数调用、`in`</b>操作等。

## 2. 特性

- 支持 <b>trap</b>（拦截器）来拦截对象操作，如 `get`、`set`、`deleteProperty`、`apply`、`construct` 等。
- 可以与 `Reflect` 搭配，调用对象默认行为。
- 可以拦截整个对象，而不仅仅是已有属性（比 `Object.defineProperty` 灵活）。

## 3. 用途

- 数据绑定与响应式（Vue3 响应式系统核心）。
- 访问控制、权限验证。
- 日志记录、数据监控。
- 默认值处理或数据验证。

## 4. 示例

```ts
const target = { name: 'natnan' };
const proxy = new Proxy(target, {
  get(obj, prop) {
    console.log(`读取属性: ${String(prop)}`);
    return obj[prop] ?? '默认值';
  },
  set(obj, prop, value) {
    console.log(`设置属性: ${String(prop)} = ${value}`);
    obj[prop] = value;
    return true;
  },
});

console.log(proxy.name); // 读取属性: name -> 'natnan'
console.log(proxy.age); // 读取属性: age -> '默认值'
proxy.age = 35; // 设置属性: age = 35
```

## 5. 面试加分点

- <b>可以强调 `Proxy` 的 整体拦截能力 vs `Object.defineProperty` 的局部拦截。</b>
  - [5.1 整体拦截能力](#5-1-整体拦截能力)
- <b>提及 与 `Reflect` 配合使用 可以保留对象默认行为。</b>
  - [5.2 配合 Reflect](#5-2-配合-Reflect)
- <b>举例 Vue3 或日志监控应用场景，更贴近实际项目经验。</b>
  - [5.3 Vue3 实际应用](#5-3-Vue3实际应用)

---

#### 5.1 整体拦截能力

Proxy 可以拦截整个对象操作，比 Object.defineProperty 灵活。

- <b>`Proxy` 可以拦截整个对象的操作</b>（新增属性、删除属性、函数调用等），而 `defineProperty` 只能拦截已有属性。
- <b>`Proxy` 支持更多 trap</b>：如 `get`, `set`, `has`, `deleteProperty`, `apply`, `construct` 等。
- `defineProperty` 在处理数组或动态属性时，代码更繁琐。

#### 5.2 配合 Reflect

`Reflect` 提供对象的默认操作，实现 `Proxy` 内部对原对象的安全操作。

```ts
const proxy = new Proxy(obj, {
  set(target, prop, value) {
    if (value < 0) return false; // 自定义逻辑
    return Reflect.set(target, prop, value); // 保留默认赋值行为
  },
});
```

#### 5.3 Vue3 实际应用

Vue3 响应式、权限控制、日志监控、数据验证等。

- Vue3 响应式核心：通过 `Proxy` 拦截对象读取和写入，实现自动依赖收集和更新。可以实现懒加载、数据校验、权限控制等功能。
- `Proxy` 可拦截对象访问，记录操作日志或防止非法访问。
  ```ts
  const logger = new Proxy(userObj, {
    get(obj, prop) {
      console.log(`访问了 ${String(prop)}`);
      return obj[prop];
    },
  });
  ```
- `Proxy` 拦截全部操作，灵活但可能略影响性能，适合关键对象或响应式场景，不建议滥用。与 WeakMap/WeakSet 搭配可管理对象生命周期，避免内存泄漏。
