# Vue-Router 路由守卫

路由守卫（Navigation Guards）是 Vue-Router 提供的一种机制，用于在路由切换过程中拦截、验证或控制导航行为。通过路由守卫，可以在页面跳转前或跳转后执行自定义逻辑，例如权限校验、数据加载、导航取消等。

## 1. 概念

- 路由守卫是 Vue-Router 的钩子函数，在路由跳转的不同阶段触发。
- 核心功能：拦截路由、控制导航、执行异步逻辑。
- 支持多种类型的守卫，分别作用于全局、单条路由或组件内部。

## 2. 类型及用法

### 2.1 全局守卫

#### 2.1.1 `beforeEach`

在每次导航前触发，可用来判断权限、记录日志等。

```js
router.beforeEach((to, from, next) => {
  if (to.meta.requiresAuth && !isLoggedIn()) {
    next('/login'); // 重定向到登录页
  } else {
    next(); // 允许导航
  }
});
```

#### 2.1.2 `beforeResolve`

在导航确认之前、解析完异步组件后触发。

```js
router.beforeResolve((to, from, next) => {
  console.log('解析完异步组件');
  next();
});
```

#### 2.1.3 `afterEach`

导航完成后触发，不会改变导航行为。适合日志记录、统计等。

```js
router.afterEach((to, from) => {
  console.log(`从 ${from.fullPath} 跳转到 ${to.fullPath}`);
});
```

### 2.2 路由独享守卫

定义在路由对象中，仅针对该路由生效。

```js
const routes = [
  {
    path: '/about',
    component: About,
    beforeEnter: (to, from, next) => {
      console.log('About 页面守卫');
      next();
    },
  },
];
```

### 2.3 组件内守卫

在组件内部定义，控制该组件的路由行为。

```js
<script>
export default {
  beforeRouteEnter(to, from, next) {
    console.log('组件进入前');
    next(vm => {
      console.log('组件实例访问', vm);
    });
  },
  beforeRouteUpdate(to, from, next) {
    console.log('组件路由更新');
    next();
  },
  beforeRouteLeave(to, from, next) {
    console.log('组件离开前');
    next();
  }
}
</script>
```

## 3. 使用场景

1. **权限控制**：未登录用户禁止访问特定页面，重定向到登录页。
2. **数据预加载**：导航到页面前加载必要数据，确保页面渲染完整。
3. **表单离开提醒**：在组件内守卫 `beforeRouteLeave` 提示用户保存未提交表单。
4. **日志统计**：全局守卫 `afterEach` 记录用户访问轨迹。
5. **动态路由拦截**：根据用户角色动态决定是否允许访问某些路由。

## 4. 总结

- Vue-Router 提供三种守卫：全局守卫、路由独享守卫、组件内守卫。
- 守卫在路由生命周期的不同阶段触发，提供灵活的导航控制能力。
- 合理使用路由守卫可以实现权限管理、数据预加载、用户提示和日志统计等功能。
