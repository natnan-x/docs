# Vue 生命周期详解

**定义：**
Vue 生命周期是组件从创建、挂载、更新到销毁的全过程中一系列钩子函数的总称。掌握生命周期是理解组件运行机制、执行副作用逻辑、优化性能的关键。

## 一、Vue2 与 Vue3 生命周期对照汇总

| 阶段            | Vue2 生命周期钩子 | Vue3 对应钩子（组合式 API） | 主要用途                           |
| --------------- | ----------------- | --------------------------- | ---------------------------------- |
| 创建前          | beforeCreate      | setup（逻辑替代）           | 初始化数据、依赖注入前             |
| 创建后          | created           | setup（逻辑替代）           | 获取初始数据、调用接口             |
| 挂载前          | beforeMount       | onBeforeMount               | 模板编译完成但未渲染               |
| 挂载后          | mounted           | onMounted                   | 操作 DOM、请求接口、注册事件监听   |
| 更新前          | beforeUpdate      | onBeforeUpdate              | 数据更新但视图未更新，可做数据校验 |
| 更新后          | updated           | onUpdated                   | 视图更新后操作 DOM、动画处理       |
| 卸载前          | beforeDestroy     | onBeforeUnmount             | 清除定时器、取消订阅、解绑事件     |
| 卸载后          | destroyed         | onUnmounted                 | 清理内存、断开引用、防止内存泄漏   |
| keep-alive 激活 | activated         | onActivated                 | 缓存组件被激活时恢复状态           |
| keep-alive 停用 | deactivated       | onDeactivated               | 缓存组件失活时保存状态             |
| 错误捕获        | errorCaptured     | onErrorCaptured             | 捕获子组件运行时错误               |

## 二、各生命周期阶段详细说明

### 1. 创建阶段

**钩子：** `beforeCreate`、`created`

**执行顺序：** 初始化 → 数据观测 → 实例化完成

**常见用途：**

- 初始化组件内数据、计算属性、侦听器
- 发送初次请求（如拉取页面基础数据）
- 不可访问 DOM（此时尚未挂载）

```typescript
created() {
  this.fetchUserInfo(); // 拉取初始化数据
}
```

### 2. 挂载阶段

**钩子：** `beforeMount`、`mounted`

**执行顺序：** 模板编译完成 → 虚拟 DOM 创建 → DOM 渲染

**常见用途：**

- 访问并操作 DOM 元素
- 绑定第三方库（如 ECharts、Swiper）
- 注册全局事件、监听滚动等

```typescript
onMounted(() => {
  const chart = echarts.init(document.getElementById('chart'));
  chart.setOption(option);
});
```

### 3. 更新阶段

**钩子：** `beforeUpdate`、`updated`

**执行顺序：** 响应式数据变化 → 虚拟 DOM diff → 重新渲染

**常见用途：**

- 在更新前做数据校验或缓存旧值
- 在视图更新后执行动画或 DOM 对比

```typescript
onBeforeUpdate(() => {
  console.log('组件即将更新');
});

onUpdated(() => {
  console.log('DOM 已更新');
});
```

### 4. 卸载阶段

**钩子：** `beforeUnmount`、`unmounted`

**执行顺序：** 从页面移除组件 → 销毁绑定事件、清理内存

**常见用途：**

- 清除 `setInterval` / `setTimeout`
- 解绑事件监听器（如 window resize）
- 断开 WebSocket、API 轮询

```typescript
onBeforeUnmount(() => {
  clearInterval(timer);
  window.removeEventListener('resize', handleResize);
});
```

### 5. keep-alive 阶段

**钩子：** `activated`、`deactivated`

**常见用途：**

- `activated`：从缓存中恢复组件状态，如分页、滚动位置。
- `deactivated`：离开时保存状态。

```typescript
onActivated(() => {
  console.log('缓存组件被激活');
});

onDeactivated(() => {
  console.log('缓存组件被停用');
});
```

### 6. 错误捕获阶段

**钩子：** `errorCaptured`

**常见用途：** 捕获子组件运行时错误，记录日志或上报。

```typescript
onErrorCaptured((err, instance, info) => {
  console.error('捕获到错误：', err);
  return false; // 阻止错误继续向上传递
});
```

## 三、生命周期执行顺序总结（图示逻辑）

```
beforeCreate → created → beforeMount → mounted → beforeUpdate → updated → beforeUnmount → unmounted
```

## 四、总结（面试高频一句话）

> Vue 生命周期是组件运行的完整流程，从创建、挂载、更新到卸载。开发中常在 mounted 操作 DOM、在 updated 处理数据联动、在 unmounted 清理副作用，是掌握 Vue 组件逻辑的核心基础。
