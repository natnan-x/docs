import{_ as i,c as a,o as n,ah as t}from"./chunks/framework.D_x7hp0y.js";const o=JSON.parse('{"title":"Vue Router 导航解析全过程","description":"","frontmatter":{},"headers":[],"relativePath":"vue/ecology/router/导航解析.md","filePath":"vue/ecology/router/导航解析.md","lastUpdated":1762527142000}'),e={name:"vue/ecology/router/导航解析.md"};function h(l,s,p,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="vue-router-导航解析全过程" tabindex="-1">Vue Router 导航解析全过程 <a class="header-anchor" href="#vue-router-导航解析全过程" aria-label="Permalink to “Vue Router 导航解析全过程”">​</a></h1><blockquote><p>Vue Router 4（Vue3）完整导航解析流程，可直接复制到 VitePress 项目中使用。</p></blockquote><h2 id="一、导航的定义" tabindex="-1">一、导航的定义 <a class="header-anchor" href="#一、导航的定义" aria-label="Permalink to “一、导航的定义”">​</a></h2><p><strong>导航（Navigation）</strong> 指路由从一个页面（<code>from</code>）切换到另一个页面（<code>to</code>）的全过程。</p><h2 id="二、完整导航流程" tabindex="-1">二、完整导航流程 <a class="header-anchor" href="#二、完整导航流程" aria-label="Permalink to “二、完整导航流程”">​</a></h2><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>触发导航</span></span>
<span class="line"><span>   ↓</span></span>
<span class="line"><span>1. 全局前置守卫 beforeEach</span></span>
<span class="line"><span>   ↓</span></span>
<span class="line"><span>2. 路由独享守卫 beforeEnter</span></span>
<span class="line"><span>   ↓</span></span>
<span class="line"><span>3. 组件内 beforeRouteLeave</span></span>
<span class="line"><span>   ↓</span></span>
<span class="line"><span>4. 组件内 beforeRouteUpdate</span></span>
<span class="line"><span>   ↓</span></span>
<span class="line"><span>5. 组件内 beforeRouteEnter</span></span>
<span class="line"><span>   ↓</span></span>
<span class="line"><span>6. 异步组件加载</span></span>
<span class="line"><span>   ↓</span></span>
<span class="line"><span>7. 全局解析守卫 beforeResolve</span></span>
<span class="line"><span>   ↓</span></span>
<span class="line"><span>8. 导航确认（更新 currentRoute）</span></span>
<span class="line"><span>   ↓</span></span>
<span class="line"><span>9. 全局后置守卫 afterEach</span></span>
<span class="line"><span>   ↓</span></span>
<span class="line"><span>10. 组件挂载 / 激活 mounted / activated</span></span></code></pre></div><h2 id="三、源码角度理解" tabindex="-1">三、源码角度理解 <a class="header-anchor" href="#三、源码角度理解" aria-label="Permalink to “三、源码角度理解”">​</a></h2><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 伪代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(location) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> to</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(location)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> from</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentRoute.value</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  runGuardQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(beforeEachGuards, to, from)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  runGuardQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(beforeEnterGuards, to, from)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  runGuardQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(componentGuards, to, from)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> resolveAsyncComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(to)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  runGuardQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(beforeResolveGuards, to, from)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  currentRoute.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> to</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  afterEachGuards.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(to, from))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="四、阶段解析" tabindex="-1">四、阶段解析 <a class="header-anchor" href="#四、阶段解析" aria-label="Permalink to “四、阶段解析”">​</a></h2><h3 id="_1-触发导航" tabindex="-1">1. 触发导航 <a class="header-anchor" href="#_1-触发导航" aria-label="Permalink to “1. 触发导航”">​</a></h3><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/home&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">link to</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/about&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">关于</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">link</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="_2-守卫阶段" tabindex="-1">2. 守卫阶段 <a class="header-anchor" href="#_2-守卫阶段" aria-label="Permalink to “2. 守卫阶段”">​</a></h3><table tabindex="0"><thead><tr><th>阶段</th><th>钩子</th><th>注册位置</th></tr></thead><tbody><tr><td>全局前置守卫</td><td>beforeEach</td><td>全局</td></tr><tr><td>路由独享守卫</td><td>beforeEnter</td><td>路由配置</td></tr><tr><td>组件离开守卫</td><td>beforeRouteLeave</td><td>组件内</td></tr><tr><td>组件更新守卫</td><td>beforeRouteUpdate</td><td>组件内</td></tr><tr><td>组件进入守卫</td><td>beforeRouteEnter</td><td>组件内</td></tr><tr><td>全局解析守卫</td><td>beforeResolve</td><td>全局</td></tr><tr><td>全局后置守卫</td><td>afterEach</td><td>全局</td></tr></tbody></table><h3 id="_3-守卫执行顺序" tabindex="-1">3. 守卫执行顺序 <a class="header-anchor" href="#_3-守卫执行顺序" aria-label="Permalink to “3. 守卫执行顺序”">​</a></h3><ol><li>beforeRouteLeave</li><li>beforeEach</li><li>beforeEnter</li><li>beforeRouteUpdate</li><li>beforeRouteEnter</li><li>beforeResolve</li><li>afterEach</li></ol><h3 id="_4-异步组件加载阶段" tabindex="-1">4. 异步组件加载阶段 <a class="header-anchor" href="#_4-异步组件加载阶段" aria-label="Permalink to “4. 异步组件加载阶段”">​</a></h3><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> routes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { path: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/about&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@/views/About.vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre></div><h3 id="_5-导航确认阶段" tabindex="-1">5. 导航确认阶段 <a class="header-anchor" href="#_5-导航确认阶段" aria-label="Permalink to “5. 导航确认阶段”">​</a></h3><ul><li>所有守卫执行完成且未调用 <code>next(false)</code></li><li>更新 <code>currentRoute</code></li><li>渲染组件</li></ul><h3 id="_6-后置守卫阶段" tabindex="-1">6. 后置守卫阶段 <a class="header-anchor" href="#_6-后置守卫阶段" aria-label="Permalink to “6. 后置守卫阶段”">​</a></h3><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">afterEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;已跳转到:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, to.fullPath);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="_7-错误与中断处理" tabindex="-1">7. 错误与中断处理 <a class="header-anchor" href="#_7-错误与中断处理" aria-label="Permalink to “7. 错误与中断处理”">​</a></h3><table tabindex="0"><thead><tr><th>触发方式</th><th>结果</th></tr></thead><tbody><tr><td>next(false)</td><td>取消导航</td></tr><tr><td>next(&#39;/login&#39;)</td><td>重定向</td></tr><tr><td>抛出错误</td><td>router.onError 捕获</td></tr><tr><td>未调用 next()</td><td>导航挂起</td></tr></tbody></table><h2 id="五、完整示例" tabindex="-1">五、完整示例 <a class="header-anchor" href="#五、完整示例" aria-label="Permalink to “五、完整示例”">​</a></h2><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">beforeEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1.beforeEach&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (to.meta.auth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">beforeResolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2.beforeResolve&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">afterEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3.afterEach&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>输出顺序：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>1.beforeEach</span></span>
<span class="line"><span>2.beforeResolve</span></span>
<span class="line"><span>3.afterEach</span></span></code></pre></div><h2 id="六、核心总结" tabindex="-1">六、核心总结 <a class="header-anchor" href="#六、核心总结" aria-label="Permalink to “六、核心总结”">​</a></h2><blockquote><p><strong>从触发导航到确认渲染，Vue Router 按顺序执行守卫 → 加载组件 → 更新状态 → 渲染 → 执行后置钩子。</strong></p></blockquote>`,29)])])}const g=i(e,[["render",h]]);export{o as __pageData,g as default};
