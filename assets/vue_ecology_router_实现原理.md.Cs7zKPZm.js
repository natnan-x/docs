import{_ as l,I as n,c as h,o as r,ah as i,j as a,a as e,J as o}from"./chunks/framework.D_x7hp0y.js";const F=JSON.parse('{"title":"Vue-Router 实现原理","description":"","frontmatter":{},"headers":[],"relativePath":"vue/ecology/router/实现原理.md","filePath":"vue/ecology/router/实现原理.md","lastUpdated":1763384180000}'),p={name:"vue/ecology/router/实现原理.md"},k={id:"_1-3-路由视图",tabindex:"-1"};function d(E,s,c,u,g,y){const t=n("router-view");return r(),h("div",null,[s[3]||(s[3]=i('<h1 id="vue-router-实现原理" tabindex="-1">Vue-Router 实现原理 <a class="header-anchor" href="#vue-router-实现原理" aria-label="Permalink to “Vue-Router 实现原理”">​</a></h1><p>Vue-Router 是 Vue 官方提供的路由管理器，其核心原理是通过 <strong>监听浏览器地址变化</strong> 来动态渲染组件，并结合 Vue 的响应式系统实现页面的切换。下面详细分析。</p><h2 id="_1-核心组成" tabindex="-1">1. 核心组成 <a class="header-anchor" href="#_1-核心组成" aria-label="Permalink to “1. 核心组成”">​</a></h2><h3 id="_1-1-路由配置对象" tabindex="-1">1.1 路由配置对象 <a class="header-anchor" href="#_1-1-路由配置对象" aria-label="Permalink to “1.1 路由配置对象”">​</a></h3><ul><li><code>routes</code> 数组：存放每个路由对应的 <code>path</code> 和组件 <code>component</code>。</li><li>每个路由配置会在创建 <code>Router</code> 实例时注册。</li></ul><h3 id="_1-2-路由实例-router" tabindex="-1">1.2 路由实例（Router） <a class="header-anchor" href="#_1-2-路由实例-router" aria-label="Permalink to “1.2 路由实例（Router）”">​</a></h3><ul><li>创建 <code>Router</code> 实例时，会初始化路由模式（Hash 或 History）</li><li>提供全局 API，如 <code>push</code>、<code>replace</code>、<code>beforeEach</code> 等。</li></ul>',7)),a("h3",k,[s[0]||(s[0]=e("1.3 路由视图（",-1)),o(t),s[1]||(s[1]=e("） ",-1)),s[2]||(s[2]=a("a",{class:"header-anchor",href:"#_1-3-路由视图","aria-label":"Permalink to “1.3 路由视图（）”"},"​",-1))]),s[4]||(s[4]=i(`<ul><li><code>&lt;router-view/&gt;</code> 是路由出口，内部通过 Vue 的响应式系统监听当前路由状态。</li><li>当路由改变时，会渲染对应的组件。</li></ul><h3 id="_1-4-路由守卫" tabindex="-1">1.4 路由守卫 <a class="header-anchor" href="#_1-4-路由守卫" aria-label="Permalink to “1.4 路由守卫”">​</a></h3><ul><li>全局守卫、路由独享守卫、组件内守卫，本质都是在路由切换时触发的回调函数。</li><li>可以通过 <code>next()</code> 控制路由的跳转逻辑。</li></ul><h2 id="_2-工作原理步骤" tabindex="-1">2. 工作原理步骤 <a class="header-anchor" href="#_2-工作原理步骤" aria-label="Permalink to “2. 工作原理步骤”">​</a></h2><ol><li><p><strong>路由实例化</strong>：创建 <code>router</code> 对象，初始化模式、路由表、当前路由状态。</p></li><li><p><strong>地址监听</strong>：</p><ul><li><strong>Hash 模式</strong>：监听 <code>window.onhashchange</code> 事件。</li><li><strong>History 模式</strong>：监听 <code>popstate</code> 事件。</li></ul></li><li><p><strong>更新路由状态</strong>：</p><ul><li>当地址发生变化时，更新路由实例中的 <code>currentRoute</code>。</li></ul></li><li><p><strong>响应式渲染</strong>：</p><ul><li><code>&lt;router-view&gt;</code> 通过 Vue 响应式系统监听 <code>currentRoute</code>，动态渲染匹配的组件。</li></ul></li><li><p><strong>触发路由守卫</strong>：</p><ul><li>在切换前执行 <code>beforeEach</code> 或路由独享守卫，允许拦截、重定向或取消导航。</li></ul></li><li><p><strong>完成导航</strong>：</p><ul><li>当前路由状态更新完成后，渲染对应组件，调用组件内守卫 <code>beforeRouteEnter</code>。</li></ul></li></ol><h2 id="_3-响应式机制" tabindex="-1">3. 响应式机制 <a class="header-anchor" href="#_3-响应式机制" aria-label="Permalink to “3. 响应式机制”">​</a></h2><ul><li><code>router.currentRoute</code> 是一个响应式对象。</li><li><code>&lt;router-view&gt;</code> 依赖 <code>currentRoute.value.matched</code> 渲染对应组件。</li><li>Vue 3 使用 Proxy 对象实现响应式，保证路由变化时自动更新视图。</li></ul><h2 id="_4-hash-与-history-区别在原理上的体现" tabindex="-1">4. Hash 与 History 区别在原理上的体现 <a class="header-anchor" href="#_4-hash-与-history-区别在原理上的体现" aria-label="Permalink to “4. Hash 与 History 区别在原理上的体现”">​</a></h2><table tabindex="0"><thead><tr><th>模式</th><th>原理</th><th>地址监听方式</th><th>页面刷新效果</th></tr></thead><tbody><tr><td>Hash</td><td>URL <code>#</code> 变化</td><td>window.onhashchange</td><td>不会 404，服务器不关心 <code>#</code> 后内容</td></tr><tr><td>History</td><td>HTML5 History API</td><td>window.popstate</td><td>页面刷新需服务器配置，否则 404</td></tr></tbody></table><h2 id="_5-总结" tabindex="-1">5. 总结 <a class="header-anchor" href="#_5-总结" aria-label="Permalink to “5. 总结”">​</a></h2><ul><li>Vue-Router 核心依赖 Vue 响应式系统 + 浏览器事件监听实现组件切换。</li><li>核心原理：路由实例 + 地址监听 + 响应式渲染 + 路由守卫。</li><li>理解其原理有助于掌握导航拦截、动态路由和路由性能优化。</li></ul><h2 id="_6-示例代码" tabindex="-1">6. 示例代码 <a class="header-anchor" href="#_6-示例代码" aria-label="Permalink to “6. 示例代码”">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createRouter, createWebHistory } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vue-router&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Home </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@/views/Home.vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> About </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@/views/About.vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> routes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { path: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, component: Home },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { path: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/about&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, component: About },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> router</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createRouter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  history: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWebHistory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  routes,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 全局守卫示例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">beforeEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;导航触发：&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, to.path);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> router;</span></span></code></pre></div>`,13))])}const b=l(p,[["render",d]]);export{F as __pageData,b as default};
